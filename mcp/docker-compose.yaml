services:
  # Spell Card Generator Server with MCP endpoint
  spell-card-server:
    build:
      context: ..
      dockerfile: Dockerfile
    container_name: spell-card-server
    ports:
      - "8000:8000"
    volumes:
      - ../cards:/app/cards
      - ../fonts:/app/fonts
      - ../template:/app/template
    networks:
      - mcp-network
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/docs').read()"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    environment:
      - PYTHONUNBUFFERED=1

  # MCP Inspector for visual testing
  mcp-inspector:
    image: ghcr.io/modelcontextprotocol/inspector:latest
    container_name: mcp-inspector
    ports:
      - "127.0.0.1:6274:6274"
      - "127.0.0.1:6277:6277"
    networks:
      - mcp-network
    depends_on:
      spell-card-server:
        condition: service_healthy
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      - HOST=0.0.0.0
      - ALLOWED_ORIGINS=http://127.0.0.1:6274,http://localhost:6274
      # Configure inspector to connect to our MCP server
      - MCP_SERVER_URL=http://spell-card-server:8000/mcp

networks:
  mcp-network:
    driver: bridge
